<%= form_with(model: product, local: true, :html => { :multipart => true }) do |form| %>
  <% if product.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(product.errors.count, "error") %> prohibited this product from being saved:</h2>

      <ul>
      <% product.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <div class="field">
    <%= form.label :name %>
    <%= form.text_field :name, id: :product_name %>
  </div>


  <div class="field">
    <%= form.label :price %>
    <%= form.number_field :price, id: :product_price %>
  </div>

  <div class=form-group> 
    <%= form.file_field :image %>

  </div>
  <div class="field">
    <%= form.label "Group" %>
    <select id="Group">
      <% GroupCategory.all.each do |c| %>
        <option value="<%=c.id %>"> <%= c.name %> </option>
      <% end %>
    </select>
  </div>
  <div class="field">
    <%= form.label "Categories" %>
    <select id="Cat">
    <% cats=GroupCategory.first.categories %>
      <% cats.each do |c| %>
        <option value="<%=c.id %>"> <%= c.name %> </option>
      <% end %>
    </select>
  </div>
  <div class="form-group">       
        <%= form.label :sub_categories_id, :class=>"control-label visible-ie8 visible-ie9" %>
      <%= select_tag(:sub_categories_id, options_from_collection_for_select(cats.first.sub_categories,'id','name',1), :class=>"form-control") %>
  </div><br>

  <div class="field">
    <%= form.label :description %>
    <%= form.text_area :description, id: :product_description %>
  </div>

  <div class="actions">
    <%= form.submit %>
  </div>
<% end %>
<script>
  $(document).ready(function(){
    $("#Group").change(function(){
      debugger;
      GroupAjax();
    });
    $("#Cat").change(function(){
      debugger;
      CategoryAjax();
    });
    function GroupAjax()
    {
      $.ajax({
          url: '/group_categories/'+$("#Group").val(),
          dataType: "json",
          method: 'get',
          success: function(response){
                console.log(response);
                fillDropDown(response,"#Cat");
                CategoryAjax();
          }
      });
    }
    function CategoryAjax()
    {
      $.ajax({
          url: '/group_categories/'+$("#Group").val()+'/categories/'+$("#Cat").val(),
          dataType: "json",
          method: 'get',
          success: function(response){
                console.log(response);
                fillDropDown(response,"#sub_categories_id");
          }
      });
    }

    function fillDropDown(response,$id)
    {
      var str = "";
      for(var x in response )
      {
        str += '<option value="'+response[x].id+'"> '+response[x].name+' </option>'
      }
      $($id).html(str)
    }
  })
</script>
